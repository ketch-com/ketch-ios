<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
            function emitEvent(event, args) {

                if (window.androidListener || (window.webkit && window.webkit.messageHandlers)) {

                    const filteredArgs = []
                    for (const arg of args) {
                      if (arg !== this) {
                        filteredArgs.push(arg)
                      }
                    }

                    let argument
                    if (filteredArgs.length === 1 && typeof filteredArgs[0] === 'string') {
                        argument = filteredArgs[0]
                      } else if (filteredArgs.length === 1) {
                        argument = JSON.stringify(filteredArgs[0])
                      } else if (filteredArgs.length > 1) {
                        argument = JSON.stringify(filteredArgs)
                      }

                    // document.write('iOS events:', event);
                    // document.write('argument:', argument);

                    if (window.androidListener && event in window.androidListener) {
                        if (filteredArgs.length === 0) {
                            window.androidListener[event]()
                        } else {
                            window.androidListener[event](argument)
                        }
                    } else if ((window.webkit && window.webkit.messageHandlers) && event in window.webkit.messageHandlers) {
                        window.webkit.messageHandlers[event].postMessage(argument)
                    } else {
                        console.warn("Can't pass message to native code because '${event}' handler is not registered")
                    }
                }
            }

            // A temporary workaround while "onConfigLoaded" event is not available
            // TODO: remove this call once onConfigLoaded event is available
            setTimeout(function() {
                ketch('getFullConfig', function(config) {
                   emitEvent("onConfigLoaded", [config])
                })
            }, 1000);

            // A temporary workaround to get banner/modal dimensions on tablets
            // TODO: remove this once there will be a way to get dialogs position from JS SDK
            function getDialogSize() {
                var domElem = document.querySelector('#lanyard_root div[role="dialog"]');
                if (!domElem) {
                    return;
                }
                var domRect = domElem.getBoundingClientRect();
                if (domRect) {
                    var dialogDimensions = [domRect.width, domRect.height];
                    emitEvent("willShowExperienceDialog", dialogDimensions);
                    return dialogDimensions;
                }
            }

            // Get query parameters
            let params = (new URL(document.location)).searchParams;

            // Get property name from query parameters
            let propertyName = params.get("propertyName");
            // Get organization code from query parameters
            let orgCode = params.get("orgCode");

            var e=document.createElement("script");
            e.type="text/javascript";
            e.src=`https://dev.ketchcdn.com/web/v2/config/${orgCode}/${propertyName}/boot.js`;
            e.defer=e.async=!0;
            document.getElementsByTagName("head")[0].appendChild(e);
            window.semaphore=window.semaphore||[];
        </script>
</head>
<body>
</body>
</html>
